package com.example.come_on;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.text.DateFormat;
import java.util.Calendar;
import java.util.Date;
import java.text.*;

import com.example.come_on.file.FileService;

import android.support.v7.app.ActionBarActivity;
import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.res.AssetManager;
import android.media.MediaPlayer;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.ExpandableListView.OnChildClickListener;
import android.widget.ImageButton;
import android.widget.TextView;
import android.widget.Toast;


public class MainActivity extends Activity {
	private Button button;
	private TextView textView1,textView2;
	private ImageButton imageButton;
	private SharedPreferences sp;
	MediaPlayer mp2 = null;
	private boolean isTheSameDate;
	private FileService service = null;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        button  = (Button)this.findViewById(R.id.button1);
        imageButton = (ImageButton)this.findViewById(R.id.imageButton1);
        textView1 = (TextView)this.findViewById(R.id.textView3);
        textView2 = (TextView)this.findViewById(R.id.textView2);
        mp2 = MediaPlayer.create(this, R.raw.yuzumusic);
        sp = getSharedPreferences("userInfo", 0);
        String name =sp.getString("USER_NAME", "");
        boolean remember = sp.getBoolean("remember", false);
        if(remember){
        	textView2.setText(name);
        	textView1.setText("欢迎回来");
        }
        button.setOnClickListener(new OnClickListener() {
			
			@Override
			public void onClick(View v) {
				// TODO Auto-generated method stub
				Intent intent = new Intent(MainActivity.this,
						InformationUp.class);
				startActivity(intent);
			}
		});
        
        imageButton.setOnClickListener(new OnClickListener() {
			
			@Override
			public void onClick(View v) {
				mp2.start();
       
			}
		});
        
//        try {
//        		File file = new File("time.txt");
//        		if(!file.exists()){
//				    file.createNewFile();
//				
//			}
//        		InputStream fis = new FileInputStream(file);
//        		InputStreamReader isr = new InputStreamReader(fis);
//        		FileOutputStream fos = new FileOutputStream("time.txt");
//        		BufferedReader br = new BufferedReader(isr);
//        		
//        		Date now = new Date();
//        		Calendar cal = Calendar.getInstance();
//        		DateFormat d1 = DateFormat.getDateInstance();
//        		String NowTime = d1.format(now);
//        		String PreviousTime = "";
//        		if((PreviousTime = br.readLine())==null){
//        			isTheSameDate = false;
//        			fos.write(new String(NowTime).getBytes());
//        		}
//        		else{
//        			if(PreviousTime == NowTime){
//        				isTheSameDate = true;
//        			}
//        			else{
//        				isTheSameDate = false;
//        			}
//        		}
//        		fos.write(new String(NowTime).getBytes());
//        		if(isTheSameDate){
//        			Toast.makeText(MainActivity.this, "同一天登录", 1).show();
//        		}
//        		else{
//        			Toast.makeText(MainActivity.this, "不是同一天登录", 1).show();
//        		}
//        }
//        		catch (IOException e) {
//				// TODO Auto-generated catch block
//				e.printStackTrace();
//			}
//    
        service = new FileService(this);
        String previousTime = service.readContentFromFile("time.txt");
        if(previousTime!=null) {
        	Date now = new Date();
    		Calendar cal = Calendar.getInstance();
    		DateFormat d1 = DateFormat.getDateInstance();
    		String NowTime = d1.format(now);
    		if(NowTime == previousTime) isTheSameDate = true;
    		else isTheSameDate = false;
    		boolean flag = service.saveContentToFile("time.txt",Context.MODE_WORLD_WRITEABLE,NowTime.getBytes());
//    		if(flag) {
//    			Toast.makeText(MainActivity.this, "更新时间成功", 1).show();
//    		}
        }
        else{
        	Date now = new Date();
    		Calendar cal = Calendar.getInstance();
    		DateFormat d1 = DateFormat.getDateInstance();
    		String NowTime = d1.format(now);
    		isTheSameDate = false;
    		boolean flag = service.saveContentToFile("time.txt",Context.MODE_PRIVATE,NowTime.getBytes());
//    		if(flag) {
//    			Toast.makeText(MainActivity.this, "新建时间成功", 1).show();
//    		}
        }
        if(isTheSameDate) Toast.makeText(MainActivity.this, "the same day", 1).show();
        else Toast.makeText(MainActivity.this, "is not the same day", 1).show();
        
    }
    
}



 